"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[3407],{8072:(e,n,c)=>{c.r(n),c.d(n,{assets:()=>r,contentTitle:()=>s,default:()=>u,frontMatter:()=>t,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"module-1-ros2/actions","title":"Actions","description":"Implement long-running tasks with feedback using ROS 2 actions","source":"@site/docs/module-1-ros2/actions.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/actions","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/actions","draft":false,"unlisted":false,"editUrl":"https://github.com/faizanmustafa/e-book-hackathon-2025/tree/main/my-website/docs/module-1-ros2/actions.md","tags":[],"version":"current","sidebarPosition":7,"frontMatter":{"sidebar_position":7,"title":"Actions","description":"Implement long-running tasks with feedback using ROS 2 actions"},"sidebar":"learningSidebar","previous":{"title":"Services","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/services"},"next":{"title":"URDF Basics","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/urdf-basics"}}');var i=c(4848),l=c(8453);const t={sidebar_position:7,title:"Actions",description:"Implement long-running tasks with feedback using ROS 2 actions"},s="Actions: Long-Running Tasks with Feedback",r={},o=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"When to Use Actions",id:"when-to-use-actions",level:2},{value:"Action Components",id:"action-components",level:2},{value:"Using a Standard Action",id:"using-a-standard-action",level:2},{value:"Action Server",id:"action-server",level:3},{value:"Action Client",id:"action-client",level:3},{value:"Update Entry Points",id:"update-entry-points",level:2},{value:"Build and Run",id:"build-and-run",level:2},{value:"Terminal 1: Server",id:"terminal-1-server",level:3},{value:"Terminal 2: Client",id:"terminal-2-client",level:3},{value:"Action from CLI",id:"action-from-cli",level:2},{value:"Humanoid Robot Action Example",id:"humanoid-robot-action-example",level:2},{value:"Action Architecture",id:"action-architecture",level:2},{value:"Goal States",id:"goal-states",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"1. Check for Cancellation",id:"1-check-for-cancellation",level:3},{value:"2. Regular Feedback",id:"2-regular-feedback",level:3},{value:"3. Handle Preemption",id:"3-handle-preemption",level:3},{value:"Exercise: Walk Action",id:"exercise-walk-action",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components},{Details:c}=n;return c||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"actions-long-running-tasks-with-feedback",children:"Actions: Long-Running Tasks with Feedback"})}),"\n",(0,i.jsx)(n.p,{children:"Actions handle tasks that take time to complete, providing continuous feedback and the ability to cancel mid-execution."}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Understand the action protocol"}),"\n",(0,i.jsx)(n.li,{children:"Create action servers"}),"\n",(0,i.jsx)(n.li,{children:"Build action clients"}),"\n",(0,i.jsx)(n.li,{children:"Handle goals, feedback, and results"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-actions",children:"When to Use Actions"}),"\n",(0,i.jsx)(n.mermaid,{value:"graph TD\n    A[Task Duration?] --\x3e|< 1 second| B[Service]\n    A --\x3e|> 1 second| C[Action]\n\n    C --\x3e D{Need Feedback?}\n    D --\x3e|Yes| E[Action \u2713]\n    D --\x3e|No| F{Cancelable?}\n    F --\x3e|Yes| E\n    F --\x3e|No| G[Consider Service]\n\n    style E fill:#28a745,color:#fff"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Use Actions For"}),(0,i.jsx)(n.th,{children:"Examples"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Navigation"}),(0,i.jsx)(n.td,{children:"Move robot to goal position"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Manipulation"}),(0,i.jsx)(n.td,{children:"Pick and place objects"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Motion execution"}),(0,i.jsx)(n.td,{children:"Execute trajectory"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Calibration"}),(0,i.jsx)(n.td,{children:"Multi-step calibration routines"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"action-components",children:"Action Components"}),"\n",(0,i.jsx)(n.mermaid,{value:"sequenceDiagram\n    participant Client\n    participant Server\n\n    Client->>Server: Send Goal\n    Server->>Client: Goal Accepted\n\n    loop During Execution\n        Server->>Client: Feedback (progress)\n    end\n\n    alt Success\n        Server->>Client: Result (success)\n    else Canceled\n        Client->>Server: Cancel Request\n        Server->>Client: Cancel Confirmed\n    else Failed\n        Server->>Client: Result (failed)\n    end"}),"\n",(0,i.jsx)(n.h2,{id:"using-a-standard-action",children:"Using a Standard Action"}),"\n",(0,i.jsxs)(n.p,{children:["Let's use the ",(0,i.jsx)(n.code,{children:"Fibonacci"})," action from ",(0,i.jsx)(n.code,{children:"example_interfaces"}),":"]}),"\n",(0,i.jsx)(n.h3,{id:"action-server",children:"Action Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="hello_ros2/fibonacci_server.py"',children:'import time\nimport rclpy\nfrom rclpy.action import ActionServer, GoalResponse, CancelResponse\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\n\nclass FibonacciServer(Node):\n    """Action server that computes Fibonacci sequences."""\n\n    def __init__(self):\n        super().__init__(\'fibonacci_server\')\n\n        self._action_server = ActionServer(\n            self,\n            Fibonacci,\n            \'fibonacci\',\n            execute_callback=self.execute_callback,\n            goal_callback=self.goal_callback,\n            cancel_callback=self.cancel_callback\n        )\n\n        self.get_logger().info(\'Fibonacci Action Server ready\')\n\n    def goal_callback(self, goal_request):\n        """Accept or reject incoming goal."""\n        self.get_logger().info(f\'Received goal: order={goal_request.order}\')\n\n        if goal_request.order < 0:\n            self.get_logger().warn(\'Rejecting negative order\')\n            return GoalResponse.REJECT\n\n        return GoalResponse.ACCEPT\n\n    def cancel_callback(self, goal_handle):\n        """Accept or reject cancel request."""\n        self.get_logger().info(\'Received cancel request\')\n        return CancelResponse.ACCEPT\n\n    async def execute_callback(self, goal_handle):\n        """Execute the goal."""\n        self.get_logger().info(\'Executing goal...\')\n\n        # Initialize Fibonacci sequence\n        sequence = [0, 1]\n\n        # Create feedback message\n        feedback_msg = Fibonacci.Feedback()\n\n        # Compute Fibonacci sequence\n        for i in range(1, goal_handle.request.order):\n            # Check for cancel\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                self.get_logger().info(\'Goal canceled\')\n                result = Fibonacci.Result()\n                result.sequence = sequence\n                return result\n\n            # Compute next number\n            sequence.append(sequence[i] + sequence[i - 1])\n\n            # Send feedback\n            feedback_msg.partial_sequence = sequence\n            goal_handle.publish_feedback(feedback_msg)\n            self.get_logger().info(f\'Feedback: {sequence}\')\n\n            # Simulate work\n            time.sleep(0.5)\n\n        # Mark goal as succeeded\n        goal_handle.succeed()\n\n        # Return result\n        result = Fibonacci.Result()\n        result.sequence = sequence\n        self.get_logger().info(f\'Result: {sequence}\')\n        return result\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = FibonacciServer()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.h3,{id:"action-client",children:"Action Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="hello_ros2/fibonacci_client.py"',children:'import rclpy\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom example_interfaces.action import Fibonacci\n\n\nclass FibonacciClient(Node):\n    """Action client that requests Fibonacci sequences."""\n\n    def __init__(self):\n        super().__init__(\'fibonacci_client\')\n\n        self._action_client = ActionClient(\n            self,\n            Fibonacci,\n            \'fibonacci\'\n        )\n\n        self.get_logger().info(\'Fibonacci Client ready\')\n\n    def send_goal(self, order):\n        """Send goal and wait for result."""\n        goal_msg = Fibonacci.Goal()\n        goal_msg.order = order\n\n        # Wait for server\n        self._action_client.wait_for_server()\n\n        # Send goal with feedback callback\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_msg,\n            feedback_callback=self.feedback_callback\n        )\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        """Handle goal acceptance/rejection."""\n        goal_handle = future.result()\n\n        if not goal_handle.accepted:\n            self.get_logger().info(\'Goal rejected\')\n            return\n\n        self.get_logger().info(\'Goal accepted\')\n\n        # Get result\n        self._get_result_future = goal_handle.get_result_async()\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def feedback_callback(self, feedback_msg):\n        """Handle feedback during execution."""\n        feedback = feedback_msg.feedback\n        self.get_logger().info(\n            f\'Feedback: {feedback.partial_sequence}\'\n        )\n\n    def get_result_callback(self, future):\n        """Handle final result."""\n        result = future.result().result\n        self.get_logger().info(f\'Result: {result.sequence}\')\n        rclpy.shutdown()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = FibonacciClient()\n\n    # Request Fibonacci sequence of order 10\n    node.send_goal(10)\n\n    rclpy.spin(node)\n\n\nif __name__ == \'__main__\':\n    main()\n'})}),"\n",(0,i.jsx)(n.h2,{id:"update-entry-points",children:"Update Entry Points"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="Add to setup.py"',children:"'fibonacci_server = hello_ros2.fibonacci_server:main',\n'fibonacci_client = hello_ros2.fibonacci_client:main',\n"})}),"\n",(0,i.jsx)(n.h2,{id:"build-and-run",children:"Build and Run"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="Build"',children:"cd ~/ros2_ws\ncolcon build --packages-select hello_ros2\nsource install/setup.bash\n"})}),"\n",(0,i.jsx)(n.h3,{id:"terminal-1-server",children:"Terminal 1: Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run hello_ros2 fibonacci_server\n"})}),"\n",(0,i.jsx)(n.h3,{id:"terminal-2-client",children:"Terminal 2: Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run hello_ros2 fibonacci_client\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Expected output (client):"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[INFO] [fibonacci_client]: Fibonacci Client ready\n[INFO] [fibonacci_client]: Goal accepted\n[INFO] [fibonacci_client]: Feedback: [0, 1, 1]\n[INFO] [fibonacci_client]: Feedback: [0, 1, 1, 2]\n[INFO] [fibonacci_client]: Feedback: [0, 1, 1, 2, 3]\n...\n[INFO] [fibonacci_client]: Result: [0, 1, 1, 2, 3, 5, 8, 13, 21, 34, 55]\n"})}),"\n",(0,i.jsx)(n.h2,{id:"action-from-cli",children:"Action from CLI"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="Send goal from CLI"',children:'ros2 action send_goal /fibonacci example_interfaces/action/Fibonacci "{order: 5}"\n'})}),"\n",(0,i.jsx)(n.p,{children:"With feedback:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="With feedback"',children:'ros2 action send_goal /fibonacci example_interfaces/action/Fibonacci "{order: 5}" --feedback\n'})}),"\n",(0,i.jsx)(n.h2,{id:"humanoid-robot-action-example",children:"Humanoid Robot Action Example"}),"\n",(0,i.jsx)(n.p,{children:"A more realistic navigation action:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="Navigation action concept"',children:"# Action definition would be:\n# Goal: target_pose (geometry_msgs/Pose)\n# Feedback: current_pose, distance_remaining\n# Result: success, final_pose, message\n\nclass NavigationServer(Node):\n    async def execute_callback(self, goal_handle):\n        target = goal_handle.request.target_pose\n        feedback = NavigateToPose.Feedback()\n\n        while not self.reached_goal(target):\n            if goal_handle.is_cancel_requested:\n                goal_handle.canceled()\n                return NavigateToPose.Result(success=False)\n\n            # Move toward goal\n            self.move_step(target)\n\n            # Publish feedback\n            feedback.current_pose = self.get_current_pose()\n            feedback.distance_remaining = self.distance_to(target)\n            goal_handle.publish_feedback(feedback)\n\n        goal_handle.succeed()\n        return NavigateToPose.Result(\n            success=True,\n            final_pose=self.get_current_pose()\n        )\n"})}),"\n",(0,i.jsx)(n.h2,{id:"action-architecture",children:"Action Architecture"}),"\n",(0,i.jsx)(n.mermaid,{value:'graph TB\n    subgraph Client["Action Client"]\n        A[Send Goal]\n        B[Receive Feedback]\n        C[Cancel Goal]\n        D[Receive Result]\n    end\n\n    subgraph Server["Action Server"]\n        E[Accept/Reject]\n        F[Execute]\n        G[Publish Feedback]\n        H[Complete/Abort]\n    end\n\n    A --\x3e E\n    E --\x3e F\n    F --\x3e G\n    G --\x3e B\n    C --\x3e F\n    F --\x3e H\n    H --\x3e D\n\n    style F fill:#e65c00,color:#fff'}),"\n",(0,i.jsx)(n.h2,{id:"goal-states",children:"Goal States"}),"\n",(0,i.jsx)(n.mermaid,{value:"stateDiagram-v2\n    [*] --\x3e Pending: Send Goal\n    Pending --\x3e Accepted: Accept\n    Pending --\x3e Rejected: Reject\n    Accepted --\x3e Executing: Begin\n    Executing --\x3e Succeeded: Complete\n    Executing --\x3e Aborted: Error\n    Executing --\x3e Canceling: Cancel Request\n    Canceling --\x3e Canceled: Cancel Complete\n    Succeeded --\x3e [*]\n    Aborted --\x3e [*]\n    Canceled --\x3e [*]\n    Rejected --\x3e [*]"}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"1-check-for-cancellation",children:"1. Check for Cancellation"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"async def execute_callback(self, goal_handle):\n    for step in range(total_steps):\n        if goal_handle.is_cancel_requested:\n            goal_handle.canceled()\n            return Result(success=False)\n        # Do work...\n"})}),"\n",(0,i.jsx)(n.h3,{id:"2-regular-feedback",children:"2. Regular Feedback"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Send feedback at consistent intervals\nfeedback_rate = 10  # Hz\nwhile executing:\n    # Do work...\n    if time_for_feedback():\n        goal_handle.publish_feedback(feedback)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"3-handle-preemption",children:"3. Handle Preemption"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"def goal_callback(self, goal_request):\n    # Optionally reject if already executing\n    if self.currently_executing:\n        return GoalResponse.REJECT\n    return GoalResponse.ACCEPT\n"})}),"\n",(0,i.jsx)(n.h2,{id:"exercise-walk-action",children:"Exercise: Walk Action"}),"\n",(0,i.jsx)(n.p,{children:"Create an action server/client for a walking command:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Goal"}),": Distance to walk (float)\n",(0,i.jsx)(n.strong,{children:"Feedback"}),": Distance traveled, steps taken\n",(0,i.jsx)(n.strong,{children:"Result"}),": Success, total steps"]}),"\n",(0,i.jsxs)(c,{children:[(0,i.jsx)("summary",{children:"Click for Hint"}),(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"example_interfaces/action/Fibonacci"})," as a template, but track:"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"distance_remaining"})," in feedback"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"step_count"})," in feedback"]}),"\n",(0,i.jsxs)(n.li,{children:["Loop until ",(0,i.jsx)(n.code,{children:"distance_traveled >= goal.distance"})]}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"You've learned to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Create action servers with goal/cancel/execute callbacks"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Build action clients with feedback handlers"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Send goals and receive results"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Handle cancellation gracefully"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Use actions from CLI"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsx)(n.p,{children:"Learn to model humanoid robots:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"./urdf-basics",children:"Continue to URDF Basics \u2192"})})})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,c)=>{c.d(n,{R:()=>t,x:()=>s});var a=c(6540);const i={},l=a.createContext(i);function t(e){const n=a.useContext(l);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),a.createElement(l.Provider,{value:n},e.children)}}}]);