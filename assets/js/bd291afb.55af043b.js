"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[4420],{7165:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>l,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"module-1-ros2/pubsub","title":"Publishers & Subscribers","description":"Implement the publish/subscribe communication pattern in ROS 2","source":"@site/docs/module-1-ros2/pubsub.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/pubsub","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/pubsub","draft":false,"unlisted":false,"editUrl":"https://github.com/faizanmustafa/e-book-hackathon-2025/tree/main/my-website/docs/module-1-ros2/pubsub.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5,"title":"Publishers & Subscribers","description":"Implement the publish/subscribe communication pattern in ROS 2"},"sidebar":"learningSidebar","previous":{"title":"Hello ROS 2","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/hello-ros2"},"next":{"title":"Services","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/services"}}');var r=s(4848),t=s(8453);const l={sidebar_position:5,title:"Publishers & Subscribers",description:"Implement the publish/subscribe communication pattern in ROS 2"},o="Publishers & Subscribers",c={},a=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"Publisher Node",id:"publisher-node",level:2},{value:"Subscriber Node",id:"subscriber-node",level:2},{value:"Register Entry Points",id:"register-entry-points",level:2},{value:"Build and Run",id:"build-and-run",level:2},{value:"Terminal 1: Publisher",id:"terminal-1-publisher",level:3},{value:"Terminal 2: Subscriber",id:"terminal-2-subscriber",level:3},{value:"Inspect Topics",id:"inspect-topics",level:2},{value:"Message Types",id:"message-types",level:2},{value:"Inspect a Message Type",id:"inspect-a-message-type",level:3},{value:"Quality of Service (QoS)",id:"quality-of-service-qos",level:2},{value:"Architecture Diagram",id:"architecture-diagram",level:2},{value:"Launch File",id:"launch-file",level:2},{value:"Exercise: Velocity Commander",id:"exercise-velocity-commander",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"publishers--subscribers",children:"Publishers & Subscribers"})}),"\n",(0,r.jsx)(n.p,{children:"The publish/subscribe pattern is the most common way nodes communicate in ROS 2. Learn to send and receive messages between nodes."}),"\n",(0,r.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Create publishers and subscribers"}),"\n",(0,r.jsx)(n.li,{children:"Use standard message types"}),"\n",(0,r.jsx)(n.li,{children:"Understand QoS settings"}),"\n",(0,r.jsx)(n.li,{children:"Build a complete pub/sub system"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"publisher-node",children:"Publisher Node"}),"\n",(0,r.jsx)(n.p,{children:"Create a node that publishes joint states for a humanoid robot:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="hello_ros2/joint_publisher.py"',children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\nimport math\n\n\nclass JointPublisher(Node):\n    \"\"\"Publishes simulated humanoid joint states.\"\"\"\n\n    def __init__(self):\n        super().__init__('joint_publisher')\n\n        # Create publisher\n        self.publisher = self.create_publisher(\n            JointState,           # Message type\n            '/joint_states',      # Topic name\n            10                    # Queue size\n        )\n\n        # Timer for periodic publishing (50 Hz)\n        self.timer = self.create_timer(0.02, self.publish_joints)\n        self.time = 0.0\n\n        # Define joint names for humanoid\n        self.joint_names = [\n            'left_hip_pitch', 'left_hip_roll', 'left_hip_yaw',\n            'left_knee', 'left_ankle_pitch', 'left_ankle_roll',\n            'right_hip_pitch', 'right_hip_roll', 'right_hip_yaw',\n            'right_knee', 'right_ankle_pitch', 'right_ankle_roll',\n        ]\n\n        self.get_logger().info('Joint Publisher started')\n\n    def publish_joints(self):\n        \"\"\"Publish simulated joint positions.\"\"\"\n        msg = JointState()\n\n        # Set header with current time\n        msg.header.stamp = self.get_clock().now().to_msg()\n        msg.header.frame_id = 'base_link'\n\n        # Set joint names\n        msg.name = self.joint_names\n\n        # Generate sinusoidal positions (simulated walking motion)\n        msg.position = []\n        for i, name in enumerate(self.joint_names):\n            # Different phase for each joint\n            phase = i * 0.5\n            position = 0.3 * math.sin(self.time + phase)\n            msg.position.append(position)\n\n        # Velocities and efforts (optional)\n        msg.velocity = [0.0] * len(self.joint_names)\n        msg.effort = [0.0] * len(self.joint_names)\n\n        # Publish\n        self.publisher.publish(msg)\n\n        # Increment time\n        self.time += 0.02\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointPublisher()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"subscriber-node",children:"Subscriber Node"}),"\n",(0,r.jsx)(n.p,{children:"Create a node that receives and processes joint states:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="hello_ros2/joint_subscriber.py"',children:"import rclpy\nfrom rclpy.node import Node\nfrom sensor_msgs.msg import JointState\n\n\nclass JointSubscriber(Node):\n    \"\"\"Subscribes to joint states and logs them.\"\"\"\n\n    def __init__(self):\n        super().__init__('joint_subscriber')\n\n        # Create subscription\n        self.subscription = self.create_subscription(\n            JointState,                 # Message type\n            '/joint_states',            # Topic name\n            self.joint_callback,        # Callback function\n            10                          # Queue size\n        )\n\n        self.get_logger().info('Joint Subscriber started')\n\n    def joint_callback(self, msg: JointState):\n        \"\"\"Process received joint states.\"\"\"\n        # Log first few joints\n        if len(msg.name) > 0:\n            self.get_logger().info(\n                f'Received {len(msg.name)} joints. '\n                f'First: {msg.name[0]} = {msg.position[0]:.3f} rad'\n            )\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = JointSubscriber()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,r.jsx)(n.h2,{id:"register-entry-points",children:"Register Entry Points"}),"\n",(0,r.jsxs)(n.p,{children:["Update ",(0,r.jsx)(n.code,{children:"setup.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="setup.py entry_points"',children:"entry_points={\n    'console_scripts': [\n        'hello_node = hello_ros2.hello_node:main',\n        'joint_publisher = hello_ros2.joint_publisher:main',\n        'joint_subscriber = hello_ros2.joint_subscriber:main',\n    ],\n},\n"})}),"\n",(0,r.jsx)(n.h2,{id:"build-and-run",children:"Build and Run"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Build"',children:"cd ~/ros2_ws\ncolcon build --packages-select hello_ros2\nsource install/setup.bash\n"})}),"\n",(0,r.jsx)(n.h3,{id:"terminal-1-publisher",children:"Terminal 1: Publisher"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Run publisher"',children:"ros2 run hello_ros2 joint_publisher\n"})}),"\n",(0,r.jsx)(n.h3,{id:"terminal-2-subscriber",children:"Terminal 2: Subscriber"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Run subscriber"',children:"ros2 run hello_ros2 joint_subscriber\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Expected output (subscriber):"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"[INFO] [joint_subscriber]: Joint Subscriber started\n[INFO] [joint_subscriber]: Received 12 joints. First: left_hip_pitch = 0.147 rad\n[INFO] [joint_subscriber]: Received 12 joints. First: left_hip_pitch = 0.153 rad\n...\n"})}),"\n",(0,r.jsx)(n.h2,{id:"inspect-topics",children:"Inspect Topics"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="List topics"',children:"ros2 topic list\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Output:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/joint_states\n/parameter_events\n/rosout\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Topic info"',children:"ros2 topic info /joint_states\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Output:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Type: sensor_msgs/msg/JointState\nPublisher count: 1\nSubscription count: 1\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Echo topic"',children:"ros2 topic echo /joint_states --once\n"})}),"\n",(0,r.jsx)(n.h2,{id:"message-types",children:"Message Types"}),"\n",(0,r.jsx)(n.p,{children:"Common message types for robotics:"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Package"}),(0,r.jsx)(n.th,{children:"Message"}),(0,r.jsx)(n.th,{children:"Use Case"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"std_msgs"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"String"}),", ",(0,r.jsx)(n.code,{children:"Int32"}),", ",(0,r.jsx)(n.code,{children:"Float64"})]}),(0,r.jsx)(n.td,{children:"Basic types"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"geometry_msgs"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"Pose"}),", ",(0,r.jsx)(n.code,{children:"Twist"}),", ",(0,r.jsx)(n.code,{children:"Point"})]}),(0,r.jsx)(n.td,{children:"Geometry"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"sensor_msgs"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"JointState"}),", ",(0,r.jsx)(n.code,{children:"Image"}),", ",(0,r.jsx)(n.code,{children:"Imu"})]}),(0,r.jsx)(n.td,{children:"Sensors"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:(0,r.jsx)(n.code,{children:"nav_msgs"})}),(0,r.jsxs)(n.td,{children:[(0,r.jsx)(n.code,{children:"Odometry"}),", ",(0,r.jsx)(n.code,{children:"Path"})]}),(0,r.jsx)(n.td,{children:"Navigation"})]})]})]}),"\n",(0,r.jsx)(n.h3,{id:"inspect-a-message-type",children:"Inspect a Message Type"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Show message definition"',children:"ros2 interface show sensor_msgs/msg/JointState\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Output:"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"std_msgs/Header header\nstring[] name\nfloat64[] position\nfloat64[] velocity\nfloat64[] effort\n"})}),"\n",(0,r.jsx)(n.h2,{id:"quality-of-service-qos",children:"Quality of Service (QoS)"}),"\n",(0,r.jsx)(n.p,{children:"Control reliability and latency:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="QoS examples"',children:"from rclpy.qos import QoSProfile, ReliabilityPolicy, DurabilityPolicy\n\n# Reliable delivery (for commands)\nreliable_qos = QoSProfile(\n    reliability=ReliabilityPolicy.RELIABLE,\n    durability=DurabilityPolicy.TRANSIENT_LOCAL,\n    depth=10\n)\n\n# Best effort (for sensors)\nsensor_qos = QoSProfile(\n    reliability=ReliabilityPolicy.BEST_EFFORT,\n    durability=DurabilityPolicy.VOLATILE,\n    depth=1\n)\n\n# Use in publisher/subscriber\nself.publisher = self.create_publisher(\n    JointState,\n    '/joint_states',\n    sensor_qos\n)\n"})}),"\n",(0,r.jsx)(n.h2,{id:"architecture-diagram",children:"Architecture Diagram"}),"\n",(0,r.jsx)(n.mermaid,{value:"graph LR\n    A[Joint Publisher] --\x3e|JointState| B[/joint_states]\n    B --\x3e C[Joint Subscriber]\n    B --\x3e D[RViz2]\n    B --\x3e E[Logger]\n\n    style B fill:#1e3a5f,color:#fff"}),"\n",(0,r.jsx)(n.h2,{id:"launch-file",children:"Launch File"}),"\n",(0,r.jsx)(n.p,{children:"Launch both nodes together:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="hello_ros2/launch/pubsub.launch.py"',children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\n\n\ndef generate_launch_description():\n    return LaunchDescription([\n        Node(\n            package='hello_ros2',\n            executable='joint_publisher',\n            name='joint_publisher',\n            output='screen'\n        ),\n        Node(\n            package='hello_ros2',\n            executable='joint_subscriber',\n            name='joint_subscriber',\n            output='screen'\n        ),\n    ])\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Add launch files to ",(0,r.jsx)(n.code,{children:"setup.py"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="setup.py data_files"',children:"import os\nfrom glob import glob\n\n# ... in setup()\ndata_files=[\n    # ... existing entries\n    (os.path.join('share', package_name, 'launch'),\n     glob(os.path.join('launch', '*launch.[pxy][yma]*'))),\n],\n"})}),"\n",(0,r.jsx)(n.p,{children:"Create launch directory:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/hello_ros2/launch\n"})}),"\n",(0,r.jsx)(n.p,{children:"Run with launch file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",metastring:'title="Launch both nodes"',children:"ros2 launch hello_ros2 pubsub.launch.py\n"})}),"\n",(0,r.jsx)(n.h2,{id:"exercise-velocity-commander",children:"Exercise: Velocity Commander"}),"\n",(0,r.jsx)(n.p,{children:"Create a publisher/subscriber pair for robot velocity commands:"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Publisher"}),": Send ",(0,r.jsx)(n.code,{children:"geometry_msgs/Twist"})," to ",(0,r.jsx)(n.code,{children:"/cmd_vel"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Subscriber"}),": Receive and log velocity commands"]}),"\n"]}),"\n",(0,r.jsxs)(s,{children:[(0,r.jsx)("summary",{children:"Click for Solution"}),(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-python",metastring:'title="hello_ros2/velocity_publisher.py"',children:"import rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Twist\nimport math\n\n\nclass VelocityPublisher(Node):\n    def __init__(self):\n        super().__init__('velocity_publisher')\n        self.publisher = self.create_publisher(Twist, '/cmd_vel', 10)\n        self.timer = self.create_timer(0.1, self.publish_velocity)\n        self.time = 0.0\n\n    def publish_velocity(self):\n        msg = Twist()\n        msg.linear.x = 0.5  # Forward speed m/s\n        msg.angular.z = 0.2 * math.sin(self.time)  # Turning\n        self.publisher.publish(msg)\n        self.time += 0.1\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = VelocityPublisher()\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n"})})]}),"\n",(0,r.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,r.jsx)(n.p,{children:"You've learned to:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\u2705 Create publishers with ",(0,r.jsx)(n.code,{children:"create_publisher()"})]}),"\n",(0,r.jsxs)(n.li,{children:["\u2705 Create subscribers with ",(0,r.jsx)(n.code,{children:"create_subscription()"})]}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Use sensor_msgs/JointState"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Configure QoS settings"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Create launch files"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,r.jsx)(n.p,{children:"Learn request/response communication:"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"./services",children:"Continue to Services \u2192"})})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>o});var i=s(6540);const r={},t=i.createContext(r);function l(e){const n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);