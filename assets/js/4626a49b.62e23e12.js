"use strict";(globalThis.webpackChunkmy_website=globalThis.webpackChunkmy_website||[]).push([[423],{4023:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>o,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"module-1-ros2/services","title":"Services","description":"Implement request/response communication with ROS 2 services","source":"@site/docs/module-1-ros2/services.md","sourceDirName":"module-1-ros2","slug":"/module-1-ros2/services","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/services","draft":false,"unlisted":false,"editUrl":"https://github.com/faizanmustafa/e-book-hackathon-2025/tree/main/my-website/docs/module-1-ros2/services.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6,"title":"Services","description":"Implement request/response communication with ROS 2 services"},"sidebar":"learningSidebar","previous":{"title":"Publishers & Subscribers","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/pubsub"},"next":{"title":"Actions","permalink":"/e-book-hackathon-2025/docs/module-1-ros2/actions"}}');var i=s(4848),t=s(8453);const l={sidebar_position:6,title:"Services",description:"Implement request/response communication with ROS 2 services"},c="Services: Request/Response Communication",o={},a=[{value:"Learning Objectives",id:"learning-objectives",level:2},{value:"When to Use Services",id:"when-to-use-services",level:2},{value:"Service Server",id:"service-server",level:2},{value:"Service Client",id:"service-client",level:2},{value:"Update Entry Points",id:"update-entry-points",level:2},{value:"Build and Run",id:"build-and-run",level:2},{value:"Terminal 1: Server",id:"terminal-1-server",level:3},{value:"Terminal 2: Client",id:"terminal-2-client",level:3},{value:"Call Service from CLI",id:"call-service-from-cli",level:2},{value:"Standard Service Types",id:"standard-service-types",level:2},{value:"Custom Service Definition",id:"custom-service-definition",level:2},{value:"Service Architecture",id:"service-architecture",level:2},{value:"Async Client Pattern",id:"async-client-pattern",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Exercise: Configuration Service",id:"exercise-configuration-service",level:2},{value:"Summary",id:"summary",level:2},{value:"Next Steps",id:"next-steps",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",mermaid:"mermaid",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"services-requestresponse-communication",children:"Services: Request/Response Communication"})}),"\n",(0,i.jsx)(n.p,{children:"Services provide synchronous request/response communication. Perfect for queries and configuration operations."}),"\n",(0,i.jsx)(n.h2,{id:"learning-objectives",children:"Learning Objectives"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create service servers and clients"}),"\n",(0,i.jsx)(n.li,{children:"Define custom service types"}),"\n",(0,i.jsx)(n.li,{children:"Handle service calls properly"}),"\n",(0,i.jsx)(n.li,{children:"Know when to use services vs topics"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"when-to-use-services",children:"When to Use Services"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Use Services For"}),(0,i.jsx)(n.th,{children:"Don't Use Services For"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u2705 Configuration changes"}),(0,i.jsx)(n.td,{children:"\u274c Continuous data streams"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u2705 State queries"}),(0,i.jsx)(n.td,{children:"\u274c High-frequency updates"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u2705 One-time operations"}),(0,i.jsx)(n.td,{children:"\u274c Real-time control"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\u2705 Calibration requests"}),(0,i.jsx)(n.td,{children:"\u274c Sensor data"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"service-server",children:"Service Server"}),"\n",(0,i.jsx)(n.p,{children:"Create a service that returns the robot's current pose:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="hello_ros2/pose_service.py"',children:"import rclpy\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import Pose\nfrom std_srvs.srv import Trigger\nfrom example_interfaces.srv import SetBool\n\n\nclass PoseService(Node):\n    \"\"\"Service server that provides robot pose.\"\"\"\n\n    def __init__(self):\n        super().__init__('pose_service')\n\n        # Current pose (simulated)\n        self.pose = Pose()\n        self.pose.position.x = 1.0\n        self.pose.position.y = 2.0\n        self.pose.position.z = 0.0\n\n        # Create service server\n        self.srv = self.create_service(\n            Trigger,                    # Service type\n            '/get_robot_state',         # Service name\n            self.get_state_callback     # Callback\n        )\n\n        # Service to enable/disable robot\n        self.enable_srv = self.create_service(\n            SetBool,\n            '/enable_robot',\n            self.enable_callback\n        )\n\n        self.enabled = False\n        self.get_logger().info('Pose Service ready')\n\n    def get_state_callback(self, request, response):\n        \"\"\"Handle get_robot_state requests.\"\"\"\n        self.get_logger().info('Received state request')\n\n        response.success = True\n        response.message = (\n            f'Position: ({self.pose.position.x:.2f}, '\n            f'{self.pose.position.y:.2f}, {self.pose.position.z:.2f})'\n        )\n        return response\n\n    def enable_callback(self, request, response):\n        \"\"\"Handle enable_robot requests.\"\"\"\n        self.enabled = request.data\n\n        if self.enabled:\n            self.get_logger().info('Robot ENABLED')\n            response.success = True\n            response.message = 'Robot enabled successfully'\n        else:\n            self.get_logger().info('Robot DISABLED')\n            response.success = True\n            response.message = 'Robot disabled successfully'\n\n        return response\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = PoseService()\n\n    try:\n        rclpy.spin(node)\n    except KeyboardInterrupt:\n        pass\n    finally:\n        node.destroy_node()\n        rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"service-client",children:"Service Client"}),"\n",(0,i.jsx)(n.p,{children:"Create a client that calls the service:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="hello_ros2/pose_client.py"',children:"import rclpy\nfrom rclpy.node import Node\nfrom std_srvs.srv import Trigger\n\n\nclass PoseClient(Node):\n    \"\"\"Service client that queries robot pose.\"\"\"\n\n    def __init__(self):\n        super().__init__('pose_client')\n\n        # Create service client\n        self.client = self.create_client(\n            Trigger,\n            '/get_robot_state'\n        )\n\n        # Wait for service to be available\n        while not self.client.wait_for_service(timeout_sec=1.0):\n            self.get_logger().info('Waiting for service...')\n\n        self.get_logger().info('Service available!')\n\n    def send_request(self):\n        \"\"\"Send request and wait for response.\"\"\"\n        request = Trigger.Request()\n\n        # Call service asynchronously\n        future = self.client.call_async(request)\n\n        # Wait for response\n        rclpy.spin_until_future_complete(self, future)\n\n        return future.result()\n\n\ndef main(args=None):\n    rclpy.init(args=args)\n    node = PoseClient()\n\n    # Send request\n    response = node.send_request()\n\n    if response.success:\n        node.get_logger().info(f'Success: {response.message}')\n    else:\n        node.get_logger().error(f'Failed: {response.message}')\n\n    node.destroy_node()\n    rclpy.shutdown()\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,i.jsx)(n.h2,{id:"update-entry-points",children:"Update Entry Points"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="setup.py entry_points (add these)"',children:"'pose_service = hello_ros2.pose_service:main',\n'pose_client = hello_ros2.pose_client:main',\n"})}),"\n",(0,i.jsx)(n.h2,{id:"build-and-run",children:"Build and Run"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="Build and run"',children:"cd ~/ros2_ws\ncolcon build --packages-select hello_ros2\nsource install/setup.bash\n"})}),"\n",(0,i.jsx)(n.h3,{id:"terminal-1-server",children:"Terminal 1: Server"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run hello_ros2 pose_service\n"})}),"\n",(0,i.jsx)(n.h3,{id:"terminal-2-client",children:"Terminal 2: Client"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ros2 run hello_ros2 pose_client\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Expected output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"[INFO] [pose_client]: Service available!\n[INFO] [pose_client]: Success: Position: (1.00, 2.00, 0.00)\n"})}),"\n",(0,i.jsx)(n.h2,{id:"call-service-from-cli",children:"Call Service from CLI"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",metastring:'title="Call service from command line"',children:"ros2 service call /get_robot_state std_srvs/srv/Trigger\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"waiting for service to become available...\nrequester: making request: std_srvs.srv.Trigger_Request()\n\nresponse:\nstd_srvs.srv.Trigger_Response(success=True, message='Position: (1.00, 2.00, 0.00)')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"standard-service-types",children:"Standard Service Types"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Service"}),(0,i.jsx)(n.th,{children:"Request"}),(0,i.jsx)(n.th,{children:"Response"}),(0,i.jsx)(n.th,{children:"Use Case"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std_srvs/Trigger"})}),(0,i.jsx)(n.td,{children:"Empty"}),(0,i.jsx)(n.td,{children:"success, message"}),(0,i.jsx)(n.td,{children:"Simple queries"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std_srvs/SetBool"})}),(0,i.jsx)(n.td,{children:"data (bool)"}),(0,i.jsx)(n.td,{children:"success, message"}),(0,i.jsx)(n.td,{children:"Enable/disable"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.code,{children:"std_srvs/Empty"})}),(0,i.jsx)(n.td,{children:"Empty"}),(0,i.jsx)(n.td,{children:"Empty"}),(0,i.jsx)(n.td,{children:"Reset, clear"})]})]})]}),"\n",(0,i.jsx)(n.h2,{id:"custom-service-definition",children:"Custom Service Definition"}),"\n",(0,i.jsx)(n.p,{children:"For complex operations, create custom services:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-text",metastring:'title="srv/GetPose.srv"',children:"# Request\nstring frame_id\n---\n# Response\ngeometry_msgs/Pose pose\nbool success\nstring message\n"})}),"\n",(0,i.jsx)(n.p,{children:"Create in your package:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/ros2_ws/src/hello_ros2/srv\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"package.xml"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-xml",children:"<build_depend>rosidl_default_generators</build_depend>\n<exec_depend>rosidl_default_runtime</exec_depend>\n<member_of_group>rosidl_interface_packages</member_of_group>\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Update ",(0,i.jsx)(n.code,{children:"CMakeLists.txt"})," (if using ament_cmake) or create an interface package."]}),"\n",(0,i.jsx)(n.h2,{id:"service-architecture",children:"Service Architecture"}),"\n",(0,i.jsx)(n.mermaid,{value:'sequenceDiagram\n    participant Client as Pose Client\n    participant Server as Pose Service\n\n    Client->>Client: Wait for service\n    Client->>Server: Request: Trigger()\n\n    Note over Server: Process request\n    Note over Server: Get current pose\n\n    Server->>Client: Response: success=True, message="Position: ..."\n\n    Client->>Client: Process response'}),"\n",(0,i.jsx)(n.h2,{id:"async-client-pattern",children:"Async Client Pattern"}),"\n",(0,i.jsx)(n.p,{children:"For non-blocking service calls:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="Async service client"',children:"class AsyncPoseClient(Node):\n    def __init__(self):\n        super().__init__('async_pose_client')\n        self.client = self.create_client(Trigger, '/get_robot_state')\n\n        # Timer to periodically check pose\n        self.timer = self.create_timer(5.0, self.timer_callback)\n        self.future = None\n\n    def timer_callback(self):\n        if self.future is None or self.future.done():\n            # Send new request\n            request = Trigger.Request()\n            self.future = self.client.call_async(request)\n            self.future.add_done_callback(self.response_callback)\n\n    def response_callback(self, future):\n        response = future.result()\n        if response.success:\n            self.get_logger().info(f'Pose: {response.message}')\n"})}),"\n",(0,i.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,i.jsx)(n.p,{children:"Always handle service unavailability:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",metastring:'title="Robust service client"',children:"def send_request_safe(self):\n    if not self.client.service_is_ready():\n        self.get_logger().warn('Service not available')\n        return None\n\n    request = Trigger.Request()\n    future = self.client.call_async(request)\n\n    # Timeout after 5 seconds\n    rclpy.spin_until_future_complete(self, future, timeout_sec=5.0)\n\n    if future.done():\n        return future.result()\n    else:\n        self.get_logger().error('Service call timed out')\n        return None\n"})}),"\n",(0,i.jsx)(n.h2,{id:"exercise-configuration-service",children:"Exercise: Configuration Service"}),"\n",(0,i.jsx)(n.p,{children:"Create a service to configure robot parameters:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Server"}),": Accept joint limits configuration"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Client"}),": Send new limits and verify response"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.code,{children:"example_interfaces/srv/SetBool"})," or create a custom service."]}),"\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Click for Hint"}),(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Server stores configuration\nself.joint_limits = {'hip': 1.57, 'knee': 2.0}\n\n# Callback updates and confirms\ndef config_callback(self, request, response):\n    if request.data:  # Enable strict limits\n        self.joint_limits = {'hip': 0.5, 'knee': 1.0}\n        response.message = 'Strict limits enabled'\n    else:\n        self.joint_limits = {'hip': 1.57, 'knee': 2.0}\n        response.message = 'Normal limits restored'\n    response.success = True\n    return response\n"})})]}),"\n",(0,i.jsx)(n.h2,{id:"summary",children:"Summary"}),"\n",(0,i.jsx)(n.p,{children:"You've learned to:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u2705 Create service servers with callbacks"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Create service clients (sync and async)"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Use standard service types"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Call services from CLI"}),"\n",(0,i.jsx)(n.li,{children:"\u2705 Handle errors gracefully"}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,i.jsx)(n.p,{children:"Learn long-running tasks with feedback:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.a,{href:"./actions",children:"Continue to Actions \u2192"})})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>c});var r=s(6540);const i={},t=r.createContext(i);function l(e){const n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);